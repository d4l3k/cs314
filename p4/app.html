<head>
  <title>CS314 P4 Project</title>
  <link rel="stylesheet" href="css/app.css">
  <link href='https://fonts.googleapis.com/css?family=Roboto:400,300,500,700' rel='stylesheet' type='text/css'>
  <script id="waterVertexShader" type="x-vertex-shader">
    varying vec3 world_position;
    uniform float time;
    uniform float tideVariance;

    #define TIME_SCALE 1000.0

    void main()
    {
      world_position = position;
      world_position.z += tideVariance * sin(time/TIME_SCALE);
      gl_Position = projectionMatrix * modelViewMatrix * vec4(world_position, 1.0);
    }
  </script>
  <script id="waterFragmentShader" type="x-fragment-shader">
    varying vec3 world_position;

    uniform float time;
    uniform vec3 diffuse;
    uniform vec3 specular;
    // Distance cutoff where waves start appearing.
    uniform float waveThreshold;
    uniform float alpha;

    #define TIME_SCALE 1000.0
    #define WAVE_SCALE 0.4

    void main()
    {
      float timeFactor = time/TIME_SCALE;
      // Distance from the origin.
      // Inverse linear falloff is used as dist increases to reduce effect of spcular highlights.
      float dist = sqrt(pow(world_position.x, 2.0) + pow(world_position.y, 2.0));
      // Vary intensity about the unit circle- maximizing prettiness.
      // Waves rotate as a function of time and an angle about the center.
      float angle = -sin(1.5 * dot(normalize(world_position), vec3(1.0, 0.0, 0.0)) + WAVE_SCALE * timeFactor);
      // waveFactor determines the amount of specular highlight to show, in range [0, 1].
      float waveFactor = max(min(waveThreshold/dist, 1.0) * angle * sin(WAVE_SCALE * (dist + timeFactor)), 0.0);
      gl_FragColor = vec4(mix(diffuse, specular, pow(waveFactor, 2.0)), alpha);
    }
  </script>
  <script id="highlightFragmentShader" type="x-fragment-shader">
varying vec2 vUv;

uniform sampler2D tDiffuse;

void main() {
  vec4 col = texture2D( tDiffuse, vUv );
  col.a = 1.0;

  if (col == vec4(1,0,0,1)) {
  } else if (col == vec4(0,1,0,1)) {
  } else if (col == vec4(0,0,1,1)) {
  } else if (col == vec4(1,1,0,1)) {
  } else if (col == vec4(0,1,1,1)) {
  } else if (col == vec4(1,0,1,1)) {
  } else if (col == vec4(1,1,1,1)) {
  } else {
    col = vec4(0,0,0,0);
  }

  gl_FragColor = col;
}
  </script>
</head>
<body>
  <div id="overlay">
    <div id="info" class="panel hidden">
      <h1 id="title"></h1>
      <p id="desc"></p>
      <a id="destroy" class="button">Destroy +$<span id="cost"></span></a>
      <a id="unselect" class="button">X</a>
    </div>
    <br>
    <div class="panel">
      <div id="items" class="well inline">
        <a class="button selected">SELECT</a>
      </div>
      <div>
        $<span id="money">0</span>,
        <span id="score">0</span> points
      </div>
      <a id="next" class="button">Next Wave</a>
    </div>
  </div>

  <script src="bower_components/three.js/build/three.min.js"></script>
  <script src="bower_components/three.js/examples/js/shaders/CopyShader.js"></script>
  <script src="bower_components/three.js/examples/js/shaders/ConvolutionShader.js"></script>
  <script src="bower_components/three.js/examples/js/postprocessing/EffectComposer.js"></script>
  <script src="bower_components/three.js/examples/js/postprocessing/RenderPass.js"></script>
  <script src="bower_components/three.js/examples/js/postprocessing/BloomPass.js"></script>
  <script src="bower_components/three.js/examples/js/postprocessing/MaskPass.js"></script>
  <script src="bower_components/three.js/examples/js/postprocessing/ShaderPass.js"></script>
  <script src="js/HighlightPass.js"></script>
  <script src="js/world.js"></script>
  <script src="js/objects.js"></script>
  <script src="js/mobs.js"></script>
  <script src="js/app.js"></script>
</body>
